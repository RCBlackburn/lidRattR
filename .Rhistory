library(devtools)
library("roxygen2")
setwd("C:/Users/Ryan/OneDrive/Documents/Github/lidRmts")
create()
document()
library(roxygen2)
library(devtools)
install("C:/Users/Ryan/OneDrive/Github/lidRmts")
install("C:/Users/Ryan/OneDrive/Documents/Github/lidRmts")
getAnywhere(std_voxel())
library(devtools)
library(roxygen2)
setwd("C:/Users/Ryan/OneDrive/Documents/Github/")
install.packages("lidRmts")
install("lidRmts")
library(roxygen2)
library(devtools)
setwd("C:/USers/Ryan/OneDrive/Github/lidRmts")
setwd("C:/Users/Ryan/OneDrive/Documents/Github/lidRmts")
document()
setwd("C:/Users/Ryan/OneDrive/Documents/Github")
install("lidRmts")
setwd("C:/Users/Ryan/OneDrive/Documents/Github/lidRmts")
library(devtools)
library(roxygen2)
document()
setwd("C:/Users/Ryan/OneDrive/Documents/Github")
install("lidRmts")
z = 20.77
crown_area = 21.5
ntree_5 = sum(z <= 5)
metrics = list(ntrees = nrow(trees),
ntree_5 = sum(z <= 5),
ntree_10 = sum(z <= 10 & z > 5),
ntree_15 = sum(z <= 15 & z > 10),
ntree_20 = sum(z <= 20 & z > 15),
ntree_25 = sum(z <= 25 & z > 20),
ntree_30 = sum(z <= 30 & z > 25),
ntree_35 = sum(z <= 35 & z > 30),
ntree_40_up = sum(z > 35),
max_tree_z = max(z),
min_tree_z = min(z),
qmean_tree_z = sqrt(mean(z^2)),
med_tree_z = median(z),
mean_tree_z = mean(z),
sd_tree_z = sd(z),
var_tree_z = var(z),
cv_tree_z = sd(z)/mean(z),
IQR_tree_z = IQR(z),
aad_tree_z = stats::mad(z, center = mean(z)),
skew_tree_z = e1071::skewness(z),
kurt_tree_z = e1071::kurtosis(z),
L1_tree_z = Lmoments::Lmoments(z)[1],
L2_tree_z =Lmoments::Lmoments(z)[2],
L3_tree_z =Lmoments::Lmoments(z)[3],
L4_tree_z =Lmoments::Lmoments(z)[4],
Lskew_tree_z = Lmoments::Lcoefs(z)[3],
Lkurt_tree_z = Lmoments::Lcoefs(z)[4],
max_tree_crown_area = max(crown_area),
min_tree_crown_area = min(crown_area),
qmean_tree_crown_area = sqrt(mean(crown_area^2)),
med_tree_crown_area = median(crown_area),
mean_tree_crown_area = mean(crown_area),
sd_tree_crown_area = sd(crown_area),
var_tree_crown_area = var(crown_area),
cv_tree_crown_area = sd(crown_area)/mean(crown_area),
IQR_tree_crown_area = IQR(crown_area),
aad_tree_crown_area = stats::mad(crown_area, center = mean(crown_area)),
skew_tree_crown_area = e1071::skewness(crown_area),
kurt_tree_crown_area = e1071::kurtosis(crown_area),
L1_tree_crown_area = Lmoments::Lmoments(crown_area)[1],
L2_tree_crown_area =Lmoments::Lmoments(crown_area)[2],
L3_tree_crown_area =Lmoments::Lmoments(crown_area)[3],
L4_tree_crown_area =Lmoments::Lmoments(crown_area)[4],
Lskew_tree_crown_area = Lmoments::Lcoefs(crown_area)[3],
Lkurt_tree_crown_area = Lmoments::Lcoefs(crown_area)[4]
)
std_trees = function(trees)
{ sf::st_as_sf(trees)
z = trees$Z
crown_area = trees$convhull_area
metrics = list(ntrees = nrow(trees),
ntree_5 = sum(z <= 5),
ntree_10 = sum(z <= 10 & z > 5),
ntree_15 = sum(z <= 15 & z > 10),
ntree_20 = sum(z <= 20 & z > 15),
ntree_25 = sum(z <= 25 & z > 20),
ntree_30 = sum(z <= 30 & z > 25),
ntree_35 = sum(z <= 35 & z > 30),
ntree_40_up = sum(z > 35),
max_tree_z = max(z),
min_tree_z = min(z),
qmean_tree_z = sqrt(mean(z^2)),
med_tree_z = median(z),
mean_tree_z = mean(z),
sd_tree_z = sd(z),
var_tree_z = var(z),
cv_tree_z = sd(z)/mean(z),
IQR_tree_z = IQR(z),
aad_tree_z = stats::mad(z, center = mean(z)),
skew_tree_z = e1071::skewness(z),
kurt_tree_z = e1071::kurtosis(z),
L1_tree_z = Lmoments::Lmoments(z)[1],
L2_tree_z =Lmoments::Lmoments(z)[2],
L3_tree_z =Lmoments::Lmoments(z)[3],
L4_tree_z =Lmoments::Lmoments(z)[4],
Lskew_tree_z = Lmoments::Lcoefs(z)[3],
Lkurt_tree_z = Lmoments::Lcoefs(z)[4],
max_tree_crown_area = max(crown_area),
min_tree_crown_area = min(crown_area),
qmean_tree_crown_area = sqrt(mean(crown_area^2)),
med_tree_crown_area = median(crown_area),
mean_tree_crown_area = mean(crown_area),
sd_tree_crown_area = sd(crown_area),
var_tree_crown_area = var(crown_area),
cv_tree_crown_area = sd(crown_area)/mean(crown_area),
IQR_tree_crown_area = IQR(crown_area),
aad_tree_crown_area = stats::mad(crown_area, center = mean(crown_area)),
skew_tree_crown_area = e1071::skewness(crown_area),
kurt_tree_crown_area = e1071::kurtosis(crown_area),
L1_tree_crown_area = Lmoments::Lmoments(crown_area)[1],
L2_tree_crown_area =Lmoments::Lmoments(crown_area)[2],
L3_tree_crown_area =Lmoments::Lmoments(crown_area)[3],
L4_tree_crown_area =Lmoments::Lmoments(crown_area)[4],
Lskew_tree_crown_area = Lmoments::Lcoefs(crown_area)[3],
Lkurt_tree_crown_area = Lmoments::Lcoefs(crown_area)[4]
)
return(as.data.frame(metrics))
}
trees = data.frame(treeID =1, Z = 20.77, npoints = 334, convhull_area = 21.5)
std_trees(trees)
ntrees = nrow(trees)
ntree_40_up = sum(z > 35),
max_tree_z = max(z)
cv_tree_z = sd(z)/mean(z)
Lkurt_tree_crown_area = Lmoments::Lcoefs(crown_area)[4]
skew_tree_z = e1071::skewness(z)
skew_tree_z = e1071::skewness(z)
list(max_tree_z, Lkurt_tree_crown_area)
as.data.frame(skew_tree_z = e1071::skewness(z))
as.data.frame(list(skew_tree_z = e1071::skewness(z)))
as.data.frame(list(max_tree_z, Lkurt_tree_crown_area))
trees
st_as_sf(trees)
trees$x = 437863.5
trees$y = 3903153.07
library(lidR)
LASfile <- system.file("extdata", "Megaplot.laz", package="lidR")
las = readLAS(LASfile)
sum(las@data$Z >= 10 & las@data$ReturnNumber == 1)
length(las@data$Z)
sum(las@data$Z >= 10 & las@data$ReturnNumber == 1)/length(las@data$Z)
std_cloud <- function(x, y, z, ReturnNumber)
{
# number of returns
npoints = length(z)
npoints_1 = length(ReturnNumber[ReturnNumber == 1])
npoints_2 = length(ReturnNumber[ReturnNumber == 2])
npoints_3 = length(ReturnNumber[ReturnNumber == 3])
# height statistics
zmax = max(z)
zmin = min(z)
uniqz = unique(z)
zmode = uniqz[which.max(tabulate(match(z, uniqz)))]
zmean = mean(z)
zqmean = sqrt(mean(z^2))
zmed = median(z)
zsd = sd(z)
zvar = var(z)
zcv = sd(z)/mean(z)
zIQR = IQR(z)
zaad = stats::mad(z, center = mean(z))
zskew = e1071::skewness(z)
zkurt = e1071::kurtosis(z)
# L moments
zL1 = Lmoments::Lmoments(z)[1]
zL2 =Lmoments::Lmoments(z)[2]
zL3 =Lmoments::Lmoments(z)[3]
zL4 =Lmoments::Lmoments(z)[4]
zLskew = Lmoments::Lcoefs(z)[3]
zLkurt = Lmoments::Lcoefs(z)[4]
# height percentiles
percentHt1 = quantile(z, 0.01)
percentHt5 = quantile(z, 0.05)
percentHt10 = quantile(z, 0.1)
percentHt15 = quantile(z, 0.15)
percentHt20 = quantile(z, 0.20)
percentHt25 = quantile(z, 0.25)
percentHt30 = quantile(z, 0.30)
percentHt40 = quantile(z, 0.40)
percentHt50 = quantile(z, 0.50)
percentHt60 = quantile(z, 0.60)
percentHt70 = quantile(z, 0.70)
percentHt75 = quantile(z, 0.75)
percentHt80 = quantile(z, 0.80)
percentHt90 = quantile(z, 0.90)
percentHt95 = quantile(z, 0.95)
percentHt99 = quantile(z, 0.99)
# PErcent returns at height bins
d5 = (sum(z <= 5)/length(z))*100
d10 = (sum(z <= 10 & z > 5 )/length(z))*100
d15 = (sum(z <= 15 & z > 10 )/length(z))*100
d20 = (sum(z <= 20 & z > 15 )/length(z))*100
d25 = (sum(z <= 25 & z > 20 )/length(z))*100
d30 = (sum(z <= 30 & z > 25 )/length(z))*100
d35 = (sum(z <= 35 & z > 30 )/length(z))*100
d40 = (sum(z <= 40 & z > 35 )/length(z))*100
d45 = (sum(z <= 45 & z > 40 )/length(z))*100
d50 = (sum(z <= 50 & z > 45 )/length(z))*100
d55 = (sum(z > 50 )/length(z))*100
# canopy related metrics
prct_10_1r = sum(z >= 10 & ReturnNumber == 1)/ length(z)
pcrt_20_1r = sum(z >= 20 & ReturnNumber == 1)/ length(z)
prct_1r_ab_mean = sum(mean(z) >= 20 & ReturnNumber == 1)/ length(z)
prct_1r_ab_mode = sum(mode(z) >= 20 & ReturnNumber == 1)/ length(z)
pcrt_10 = sum(z >= 10)/ length(z)
pcrt_20 = sum(z >= 20)/ length(z)
prct_ab_mean = sum(mean(z) >= 20)/ length(z)
prct_ab_mode = sum(mode(z) >= 20)/ length(z)
metrics = list(
npts = npoints,
npnts_1 = npoints_1,
npnts_2 = npoints_2,
npnts_3 = npoints_3,
zmax = zmax,
zmin = zmin,
zmode = zmode,
zmean = zmean,
zqmean = zqmean,
zmed = zmed,
zsd = zsd,
zvar = zvar,
zcv = zcv,
zIQR = zIQR,
zaad = zaad,
zskew = zskew,
zkurt = zkurt,
# L moments
zL1 = zL1,
zL2 = zL2,
zL3 = zL3,
zL4 = zL4,
zLskew = zLskew,
zLkurt = zLkurt,
d5 = d5,
d10 = d10,
d15 = d15,
d20 = d20,
d25 = d25,
d30 = d30,
d35 = d35,
d40 = d40,
d45 = d45,
d50 = d50,
d55up = d55,
pHt1_m = percentHt1,
pHt5_m = percentHt5,
pHt10_m = percentHt10,
pHt15_m = percentHt15,
pHt20_m = percentHt20,
pHt25_m = percentHt25,
pHt30_m = percentHt30,
pHt40_m = percentHt40,
pHt50_m = percentHt50,
pHt60_m = percentHt60,
pHt70_m = percentHt70,
pHt75_m = percentHt75,
pHt80_m = percentHt80,
pHt90_m = percentHt90,
pHt95_m = percentHt95,
pHt99_m = percentHt99,
prct_10_1r = prct_10_1r,
pcrt_20_1r = pcrt_20_1r,
prct_1r_ab_mean = prct_1r_ab_mean,
prct_1r_ab_mode =  prct_1r_ab_mode,
pcrt_10 = pcrt_10,
pcrt_20 = pcrt_20,
prct_ab_mean = prct_ab_mean,
prct_ab_mode = prct_ab_mode
)
return(metrics)
}
std_cloud(las)
library(devtools)
library(roxygen2)
setwd("C:/Users/Ryan/OneDrive/Documents/Github/lidRmts")
document()
